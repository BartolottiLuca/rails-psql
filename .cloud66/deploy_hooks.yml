production:
  first_thing:
    - command: echo cia_first_thing
      target: any
      execute: true
    - command: bundle exec rake db:migrate
      target: rails
      execute: true
      halt_on_error: false
  after_checkout:
    - command: "cd $STACK_PATH && npm -g install npm@latest > /tmp/siavash.log 2>&1"
      target: any
      execute: true
      run_on: all_servers
    - command: "cd $STACK_PATH && sudo npm install >> /tmp/siavash.log 2>&1"
      target: any
      execute: true
      run_on: all_servers
    - command: "cat /tmp/deploy_hooks/* > /tmp/test.log && cd $STACK_PATH && sudo npm run build > /tmp/siavash.log 2>&1"
      target: rails
      execute: true
      run_on: all_servers
  before_rails:
    - command: echo cia_before_rails
      target: any
      execute: true
  after_bundle:
    - command: echo cia_after_bundle
      target: any
      execute: true
  after_symlink:
    - command: echo cia_after_symlink
      target: any
      execute: true
  after_rails:
    - command: echo cia_after_rails
      target: any
      execute: true
