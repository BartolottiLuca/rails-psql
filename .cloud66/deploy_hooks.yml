production:
  after_checkout:
    - command: "cd $STACK_PATH && npm -dd --production --spin=false --progress=false -g install npm@latest"
      target: any
      execute: true
      run_on: all_servers
    - command: "cd $STACK_PATH && sudo npm install -dd --production --spin=false --progress=false"
      target: any
      execute: true
      run_on: all_servers
    - command: "cat /tmp/deploy_hooks/* > /tmp/test.log && cd $STACK_PATH && sudo npm run build >> /tmp/siavash.log 2>&1"
      target: rails
      execute: true
      run_on: all_servers
  before_rails:
    - command: echo cia_before_rails
      target: any
      execute: true
  after_bundle:
    - command: echo cia_after_bundle
      target: any
      execute: true
  after_symlink:
    - command: echo cia_after_symlink
      target: any
      execute: true
  after_rails:
    - command: echo cia_after_rails
      target: any
      execute: true
